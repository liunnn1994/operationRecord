<h1 align="center">OpRec</h1>

<p align="center">åˆ©ç”¨ç°ä»£æµè§ˆå™¨æ‰€æä¾›çš„å¼ºå¤§ API å½•åˆ¶ï¼Œå›æ”¾å¹¶ä¿å­˜ä»»æ„ç•Œé¢ä¸­çš„ç”¨æˆ·æ“ä½œ</p>

<p align="center">
  <a href="https://github.com/asdjgfr/operationRecord" target="_blank"><img src="https://img.shields.io/github/stars/asdjgfr/operationRecord?style=social" alt="star"></a>
</p>
<p align="center">
<a href="https://github.com/asdjgfr/operationRecord" target="_blank"><img src="https://img.shields.io/npm/v/op-rec" alt="npm"></a>
<a href="https://img.shields.io/github/languages/count/asdjgfr/operationRecord" target="_blank"><img src="https://img.shields.io/github/languages/count/asdjgfr/operationRecord" alt="count"></a>
<a href="https://img.shields.io/github/languages/top/asdjgfr/operationRecord" target="_blank"><img src="https://img.shields.io/github/languages/top/asdjgfr/operationRecord" alt="top language"></a>
<a href="https://unpkg.com/op-rec@latest" target="_blank"><img src="https://img.shields.io/bundlephobia/minzip/op-rec" alt="gzip"></a>
<a href="https://unpkg.com/op-rec@latest" target="_blank"><img src="https://img.shields.io/npm/dt/op-rec" alt="gzip"></a>
<a href="https://github.com/asdjgfr/operationRecord/issues" target="_blank"><img src="https://img.shields.io/github/issues/asdjgfr/operationRecord" alt="issues"></a>
<a href="https://img.shields.io/npm/l/op-rec" target="_blank"><img src="https://img.shields.io/npm/l/op-rec" alt="license"></a>
</p>

[English](https://github.com/asdjgfr/operationRecord) | ç®€ä½“ä¸­æ–‡

- [OpRec](#oprec)
  - [ç®€è¿°](#ç®€è¿°)
  - [ç‰¹æ€§](#-ç‰¹æ€§)
  - [æ”¯æŒç¯å¢ƒ](#-æ”¯æŒç¯å¢ƒ)
  - [å®‰è£…](#-å®‰è£…)
    - [å½•åˆ¶ç«¯](#å½•åˆ¶ç«¯)
    - [ç®¡ç†ç«¯](#ç®¡ç†ç«¯)
  - [ç¤ºä¾‹](#-ç¤ºä¾‹)
  - [æœ¬åœ°å¼€å‘](#-æœ¬åœ°å¼€å‘)
  - [æ–‡æ¡£](#æ–‡æ¡£)
    - [å†…ç½®å¯¹è±¡](#å†…ç½®å¯¹è±¡)
    - [æ„é€ å‡½æ•°](#æ„é€ å‡½æ•°)
    - [é…ç½®é¡¹](#é…ç½®é¡¹)
    - [å®ä¾‹å±æ€§](#å®ä¾‹å±æ€§)
    - [å®ä¾‹æ–¹æ³•](#å®ä¾‹æ–¹æ³•)
  - [å‚ä¸å…±å»º](#-å·²çŸ¥é—®é¢˜)
  - [å‚ä¸å…±å»º](#-å‚ä¸å…±å»º)

## ç®€è¿°

åˆ©ç”¨ç°ä»£æµè§ˆå™¨çš„å¼ºå¤§`api` _([MediaDevices.getDisplayMedia()](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getDisplayMedia))_ å½•åˆ¶å¹¶å›æ”¾ç”¨æˆ·ä»»æ„ç•Œé¢ï¼ˆä¸é™äºæµè§ˆå™¨ä¸­ï¼‰çš„æ“ä½œï¼Œå¹¶æä¾›ä¸»åŠ¨ä¸ŠæŠ¥çš„åŠŸèƒ½ä»¥åŠç®¡ç†ç³»ç»Ÿã€‚

## ğŸŒŸ ç‰¹æ€§

- ğŸ§± å¼€å‘ï¼š
  - å‰ç«¯åº“ä½¿ç”¨[webpack](https://webpack.js.org/)æ‰“åŒ…ä¸º umdã€‚
  - åç«¯ä½¿ç”¨[NestJS](https://docs.nestjs.com/)ï¼Œå…¨é“¾è·¯å¼€å‘å’Œè®¾è®¡å·¥å…·ä½“ç³»ã€‚
  - åç«¯å‰ç«¯é¡µä½¿ç”¨[Vue 3](https://v3.vuejs.org/)+[Element Plus](https://element-plus.org/)æ›´ç°ä»£ã€‚
- ğŸ“¦ å¼€ç®±å³ç”¨ã€‚
- ğŸŒ€ æ— ä¾èµ–ã€‚
- ğŸ›¡ 100% TypeScript å¼€å‘ï¼Œå°½é‡è§„é¿æ„šè ¢é”™è¯¯ã€‚
- âš™ï¸ æä¾›ç®¡ç†ç³»ç»Ÿï¼Œå¹¶å¯ç‹¬ç«‹ä½¿ç”¨ã€‚

## âœ” æ”¯æŒç¯å¢ƒ

- æ‰€æœ‰ç°ä»£æµè§ˆå™¨ã€‚

| [![IE / Edge](https://user-gold-cdn.xitu.io/2019/1/30/1689cda8b4c7fe7a?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)](http://godban.github.io/browsers-support-badges/) IE / Edge | [![Firefox](https://user-gold-cdn.xitu.io/2019/1/30/1689cda8b445536a?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)](http://godban.github.io/browsers-support-badges/) Firefox | [![Chrome](https://user-gold-cdn.xitu.io/2019/1/30/1689cda8b537a517?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)](http://godban.github.io/browsers-support-badges/) Chrome | [![Safari](https://user-gold-cdn.xitu.io/2019/1/30/1689cda8b3d25b6f?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)](http://godban.github.io/browsers-support-badges/) Safari | [![Opera](https://user-gold-cdn.xitu.io/2019/1/30/1689cda8b621d60b?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)](http://godban.github.io/browsers-support-badges/) Opera |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| IE å…¨ç‰ˆæœ¬ä¸æ”¯æŒ, Edge 79 åŠä»¥ä¸Š                                                                                                                                                           | 66 åŠä»¥ä¸Š                                                                                                                                                                             | 72 åŠä»¥ä¸Š                                                                                                                                                                           | 13 åŠä»¥ä¸Š                                                                                                                                                                           | 60 åŠä»¥ä¸Š                                                                                                                                                                         |

## ğŸ“¦ å®‰è£…

### å½•åˆ¶ç«¯

> ä½¿ç”¨ yarn

```shell
$ yarn add op-rec
```

> ä½¿ç”¨ npm

```shell
$ npm install op-rec --save
```

> åœ¨æµè§ˆå™¨ä¸­

```html
ä½¿ç”¨CDN
<script type="text/javascript" src="//unpkg.com/op-rec@latest"></script>
æˆ–
<script type="text/javascript" src="op-rec.js"></script>
æˆ–
<script type="text/javascript" src="op-rec.min.js"></script>
```

### ç®¡ç†ç«¯

åœ¨[Release](https://github.com/asdjgfr/operationRecord/releases)ä¸­ä¸‹è½½å¹¶è§£å‹ï¼Œé…ç½®`.env`é‡Œé¢çš„å‚æ•°ã€‚

å®‰è£…ä¾èµ–

```shell
$ yarn
# æˆ–
$ npm i
```

å¯åŠ¨

```shell
$ node main.js
```

## ğŸ”¨ ç¤ºä¾‹

- vue

  ```vue
  <template>
    <video controls autoplay ref="video"></video>
  </template>

  <script>
  import OpRec from "op-rec";
  export default {
    data() {
      return {};
    },
    mounted() {
      const or = new OpRec();
      or.on("startREC", this.startREC);
    },
    methods: {
      startREC(stream) {
        this.$refs.video.srcObject = stream;
      },
    },
  };
  </script>
  ```

- react

  ```jsx
  import React from "react";
  import ReactDOM from "react-dom";
  import OpRec from "op-rec";

  class App extends React.Component {
    componentDidMount() {
      const or = new OpRec();
      or.on("startREC", this.startREC);
    }
    startRec(stream) {
      ReactDOM.findDOMNode(this.refs.video).srcObject = stream;
    }
    render() {
      return (
        <div>
          <video ref="video" controls autoplay></video>
        </div>
      );
    }
  }

  ReactDOM.render(<App />, document.getElementById("container"));
  ```

- åŸç”Ÿ

  ```html
  <script type="text/javascript" src="op-rec.js"></script>
  <body>
    <video controls autoplay></video>
  </body>
  <script>
    const video = document.querySelector("video");
    const or = new OpRec();
    or.on("startREC", function (stream) {
      video.srcObject = stream;
    });
  </script>
  ```

## âŒ¨ æœ¬åœ°å¼€å‘

```shell
$ git clone clone https://github.com/asdjgfr/operationRecord.git
# å¼€å‘å‰ç«¯åº“
$ cd operationRecord/src/op-rec
$ yarn
$ yarn dev
# å¼€å‘æœåŠ¡ç«¯
$ cd operationRecord/src/server
$ yarn
$ yarn dev
# å¼€å‘æœåŠ¡ç«¯å‰ç«¯é¡µé¢
$ cd operationRecord/src/server-client
$ yarn
$ yarn dev
```

## æ–‡æ¡£

### å†…ç½®å¯¹è±¡

**æ—¥å¿—ç­‰çº§**

- emerg: 0
- alert: 1
- crit: 2
- err: 3
- warning: 4
- notice: 5
- info: 6
- debug: 7

**LoggerItem**

è®°å½•å¯¹è±¡

- level: 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7

  ç­‰çº§

- content: string

  æ—¥å¿—å†…å®¹

- timestamp: number

  ç”Ÿæˆæ—¥å¿—æ—¶çš„æ—¶é—´æˆ³

### æ„é€ å‡½æ•°

**OpRec()**

åˆ›å»ºä¸€ä¸ªæ–°çš„å½•åˆ¶å®ä¾‹ã€‚

### é…ç½®é¡¹

**url** <sup>å¯é€‰</sup>

å®Œæˆåä¸Šä¼ çš„åœ°å€ï¼Œé»˜è®¤ä¸º localï¼Œåœ°å€ä¸º local çš„æ—¶å€™ä¼šæœ¬åœ°ç”Ÿæˆå¹¶ä¸‹è½½ã€‚

**fetchConfig** <sup>å¯é€‰</sup>

fetch çš„é…ç½®ã€‚

**mediaConstraints** <sup>å¯é€‰</sup>

[mediaConstraints](https://developer.mozilla.org/en-US/docs/Web/API/MediaStreamConstraints)é…ç½®ã€‚

**mimeType** <sup>å¯é€‰</sup>

mime ç±»å‹ï¼Œé»˜è®¤ä¼šé€‰æ‹©æœ€ä½³ç±»å‹ã€‚

**lang** <sup>å¯é€‰</sup>

è¯­è¨€ï¼Œé»˜è®¤ zhï¼Œæš‚æ—¶åªæœ‰ zhã€‚

**hotKeys** <sup>å¯é€‰ï¼Œé¢„ç•™ï¼Œå°šæœªæ”¯æŒ</sup>

å¿«æ·é”®ã€‚

**dom** <sup>å¯é€‰</sup>

è‡ªåŠ¨ç”Ÿæˆçš„ dom é…ç½®ã€‚

- show: boolean
- style:{key:value}

dom ä¸º false æˆ– dom.show ä¸º false çš„æ—¶å€™å°†ä¸ä¼šç”Ÿæˆæ“ä½œçš„æ ‡ç­¾ã€‚

**onStartREC** <sup>å¯é€‰</sup>

å¼€å§‹å½•åˆ¶æ—¶çš„å›è°ƒï¼Œå¯ä½¿ç”¨**OpRec.prototype.on("startREC",cb)**æ›¿ä»£ã€‚

**onStopREC** <sup>å¯é€‰</sup>

ç»“æŸå½•åˆ¶æ—¶çš„å›è°ƒï¼Œå¯ä½¿ç”¨**OpRec.prototype.on("stopREC",cb)**æ›¿ä»£ã€‚

**onPauseREC** <sup>å¯é€‰</sup>

æš‚åœå½•åˆ¶æ—¶çš„å›è°ƒï¼Œå¯ä½¿ç”¨**OpRec.prototype.on("pauseREC",cb)**æ›¿ä»£ã€‚

**onResumeREC** <sup>å¯é€‰</sup>

ç»§ç»­å½•åˆ¶æ—¶çš„å›è°ƒï¼Œå¯ä½¿ç”¨**OpRec.prototype.on("resumeREC",cb)**æ›¿ä»£ã€‚

**CSP** <sup>å¯é€‰</sup>

ç”¨äºè®¾ç½®`style`çš„`nonce`å±æ€§ã€‚ç”±äºåœ¨å†…éƒ¨é…ç½®`DOM`çš„æ—¶å€™åˆ›å»ºäº†`inline-style`æ ‡ç­¾ï¼Œè¿™ä¸[CSP](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/style-src)äº§ç”Ÿäº†å†²çªï¼Œé…ç½®æ­¤é¡¹çš„ä¸`meta`ä¸­çš„`style-src`é…åˆä½¿ç”¨ã€‚

### å®ä¾‹å±æ€§

**OpRec.prototype.DOM** ï¼ˆHTMLElement | undefinedï¼‰

ç”¨äº ui æ“ä½œçš„ domï¼Œå½“`DomOptions.show`ä¸º`false`çš„æ—¶å€™è¿”å›`undefined`ã€‚

**OpRec.prototype.startTime** ï¼ˆnumberï¼‰

å½•åˆ¶å¼€å§‹æ—¶çš„æ—¶é—´æˆ³ï¼Œé»˜è®¤ä¸º 0ã€‚

**OpRec.prototype.status** ï¼ˆ"recording" | "stop" | "paused" | "inactive"ï¼‰

å½“å‰çŠ¶æ€ï¼Œé»˜è®¤ä¸º stopã€‚

**OpRec.prototype.recordedChunks** ï¼ˆBlob[]ï¼‰

åŒ…å«åª’ä½“æ•°æ®çš„[`Blob`](https://developer.mozilla.org/zh-CN/docs/Web/API/Blob)ï¼Œé»˜è®¤ä¸º []ã€‚

**OpRec.prototype.logs** ï¼ˆLoggerItem[]ï¼‰

è®°å½•é›†åˆï¼Œé»˜è®¤ä¸º []ã€‚

**OpRec.prototype.logs** ï¼ˆLoggerItem[]ï¼‰

è®°å½•é›†åˆï¼Œé»˜è®¤ä¸º []ã€‚

**OpRec.prototype.mediaRecorder** ï¼ˆMediaRecorder | undefinedï¼‰

MediaRecorder å®ä¾‹ã€‚

**OpRec.prototype.stream** ï¼ˆMediaStream | undefinedï¼‰

MediaStreamã€‚

**OpRec.prototype.mimeType** ï¼ˆstring | undefinedï¼‰

mime ç±»å‹ã€‚

### å®ä¾‹æ–¹æ³•

**OpRec.prototype.startREC()**

å¼€å§‹å½•åˆ¶ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ã€‚

**OpRec.prototype.stopREC()**

ç»“æŸå½•åˆ¶ã€‚

**OpRec.prototype.toggleREC()**

åˆ‡æ¢å½•åˆ¶çŠ¶æ€ã€‚

**OpRec.prototype.on(type,cb)**

event äº‹ä»¶ã€‚

**OpRec.prototype.logger(loggerLever,ErrorEvent|string)**

- loggerLever:"emerg" | "alert" | "crit" | "err" | "warning" | "notice" | "info" | "debug" | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7

ä¸»åŠ¨æäº¤è®°å½•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè®°å½•ç­‰çº§ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæ—¥å¿—ä¿¡æ¯ã€‚

**OpRec.prototype.getSupportedMimeTypes()**

è·å–å½“å‰è¿è¡Œç¯å¢ƒæ”¯æŒçš„ Mime ç±»å‹ã€‚

**OpRec.prototype.getBlob()**

è·å–å½•åˆ¶åçš„ Blobã€‚

**OpRec.prototype.getExtname()**

è·å–å½•åˆ¶çš„åç¼€ã€‚

**OpRec.prototype.reset()**

é‡ç½®çŠ¶æ€ã€‚

## ğŸ¤ å·²çŸ¥é—®é¢˜

ç”±äº`mysql`çš„åº“å¹¶ä¸æ”¯æŒ`mysql 8`æ–°ç‰ˆçš„åŠ å¯†æ–¹å¼ï¼Œæ‰€ä»¥ä½¿ç”¨`8.x`éœ€è¦ä¿®æ”¹é»˜è®¤çš„åŠ å¯†æ–¹å¼ï¼š

```mysql
$ ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'password'
```

ç„¶ååˆ·æ–°ï¼š

```mysql
$ flush privileges;
```

æˆ–è€…åˆ‡æ¢ä¸º`5.x`ç‰ˆæœ¬ã€‚

## ğŸ¤ å‚ä¸å…±å»º

[![PRs Welcome](https://camo.githubusercontent.com/0ff11ed110cfa69f703ef0dcca3cee6141c0a8ef465e8237221ae245de3deb3d/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f5052732d77656c636f6d652d627269676874677265656e2e7376673f7374796c653d666c61742d737175617265)](http://makeapullrequest.com/)
æ¬¢è¿[PR](https://github.com/asdjgfr/operationRecord/pulls)
